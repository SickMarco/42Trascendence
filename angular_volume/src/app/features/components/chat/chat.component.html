<app-navbar (openChat)="isOpen = false"></app-navbar>
<main class="container">
  <section class="box">
    <section class="sidebar">
      <div class="title">
        <div class="back" *ngIf="screenW < 650 && isOpen" (click)="backClick()">
          <i class="fa-solid fa-angles-left fa-2xl" (click)="backClick()"></i>
        </div>
        <i></i>
        <p>{{ title }}</p>
      </div>
      <input
        id="search"
        [(ngModel)]="search"
        class="search"
        autocomplete="on"
        spellcheck="false"
        [placeholder]="placeholder"
        (keydown.enter)="searchChat()"
      />
      <section class="list">
        <ng-container *ngFor="let conversation of channels">
          <app-chat-user [conversation]="conversation" (openChat)="openChat($event)"></app-chat-user>
            <div *ngIf="isGroup" class="leave-channel" (click)="leaveChannel()">
            <i class="fa-solid fa-right-from-bracket"> leave</i>
          </div>
        </ng-container>
      </section>
      <div class="create-channel" (click)="newChannel.changeDialogStatus()">
        <i class="fa-solid fa-user-group"> join</i>
      </div>
    </section>
    <div class="not_found" *ngIf="msgToShow">
      {{msgToShow}}
    </div>
    <ng-container *ngIf="isOpen">
      <section class="message-area" #messageArea>
        <app-message style="display: contents;" *ngFor="let message of messages" [message]="message"></app-message>
      </section>
      <section id="userlist" #userList>
        <app-user-list [user]="whoami" [pending]="this.isPending"></app-user-list>
      </section>

      <section #modSection>
        <app-mod-section *ngIf="isGroup && this.isOwner"></app-mod-section>
      </section>
    </ng-container>

    <form class="message-container" (submit)="sendMessageToUser()">
      <input
        id="message-input"
        *ngIf="chat.length !== 0 || isOpen"
        class="message-input"
        type="text"
        autocomplete="off"
        spellcheck="true"
        [(ngModel)]="newMessage"
        name="message"
        placeholder="Type a message..."
      />
      <button *ngIf="chat.length !== 0 || isOpen" type="submit">Send</button>
    </form>
    
  </section>
  <app-new-channel #newChannel></app-new-channel>
  <div class="backdroppe" *ngIf="newChannel.isOpen" (click)="newChannel.changeDialogStatus()"></div>
  
</main>

<ng-template #snackBarTemplate>
  <div class="snackbar">
    <div>
      <p class="snackTitle">New message from {{messages[0].user}}</p>
      <span>{{messages[messages.length - 1].msg.slice(0,60)}}</span>
    </div>
    <button class="close-button" style="min-width: 64px;
      border: none;
      outline: none;
      background: rgba(0,0,0,0);
      color: var(--mat-snack-bar-button-color);">
      close
    </button>
  </div>
</ng-template>
